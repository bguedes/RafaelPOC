g.V().hasLabel('person').has('id', eq(personId)).bothE('knows').dedup().by(__.path()).otherV().as('friend').hasLabel('person').inE('hasCreator').outV().as('comment').hasLabel('comment').outE('replyOf').inV().hasLabel('post').outE('hasTag').inV().as('tag').hasLabel('tag').is(neq('  cypher.null')).outE('hasType').inV().as('tagClass').hasLabel('tagClass').emit(__.loops().is(gte(0))).repeat(__.outE('isSubclassOf').as('  UNNAMED167').inV()).times(10).as('baseTagClass').hasLabel('tagClass').where(__.or(__.select('tagClass').values('name').is(eq(tagClassName)), __.select('baseTagClass').values('name').is(eq(tagClassName)))).optional(__.select(all, '  UNNAMED167').as('  UNNAMED167')).select('friend', 'tag', 'comment').group().by(__.project('personId', 'personFirstName', 'personLastName').by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('firstName'), __.values('firstName'), __.constant('  cypher.null')))).by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('lastName'), __.values('lastName'), __.constant('  cypher.null'))))).by(__.fold().project('personId', 'personFirstName', 'personLastName', 'tagNames', 'replyCount').by(__.unfold().select('friend').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.unfold().select('friend').choose(neq('  cypher.null'), __.choose(__.values('firstName'), __.values('firstName'), __.constant('  cypher.null')))).by(__.unfold().select('friend').choose(neq('  cypher.null'), __.choose(__.values('lastName'), __.values('lastName'), __.constant('  cypher.null')))).by(__.unfold().select('tag').choose(neq('  cypher.null'), __.choose(__.values('name'), __.values('name'), __.constant('  cypher.null'))).dedup().is(neq('  cypher.null')).fold()).by(__.unfold().select('comment').dedup().is(neq('  cypher.null')).count())).unfold().select(values).order().by(__.select('replyCount'), desc).by(__.select('personId'), asc).limit(20)