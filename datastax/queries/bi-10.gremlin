g.V().as('tag').hasLabel('tag').has('name', eq(tag)).choose(__.select('tag').inE('hasInterest').as('interest').outV().as('person').hasLabel('person'), __.select('tag').inE('hasInterest').as('interest').outV().as('person').hasLabel('person'), __.constant('  cypher.null').as('interest').as('person')).select('tag', 'person').group().by(__.select('tag')).by(__.fold().project('tag', 'interestedPersons').by(__.unfold().select('tag')).by(__.unfold().select('person').is(neq('  cypher.null')).fold())).unfold().select(values).as('  GENERATED4').select('tag').as('tag').hasLabel('tag').has('name', eq(tag)).select('  GENERATED4').select('interestedPersons').as('interestedPersons').choose(__.select('tag').inE('hasTag').outV().as('message').hasLabel('post', 'comment').has('creationDate', gt(date)).outE('hasCreator').inV().as('person').hasLabel('person'), __.select('tag').inE('hasTag').outV().as('message').hasLabel('post', 'comment').has('creationDate', gt(date)).outE('hasCreator').inV().as('person').hasLabel('person'), __.constant('  cypher.null').as('message').as('person')).select('tag', 'interestedPersons', 'person').group().by(__.project('  AGGREGATION261', '  AGGREGATION266').by(__.select('tag')).by(__.select('interestedPersons'))).by(__.fold().project('  AGGREGATION261', '  AGGREGATION266', '  AGGREGATION286').by(__.unfold().select('tag')).by(__.unfold().select('interestedPersons')).by(__.unfold().select('person').is(neq('  cypher.null')).fold())).unfold().select(values).as('  GENERATED9').select('  AGGREGATION261').as('  AGGREGATION261').select('  GENERATED9').select('  AGGREGATION266').as('  AGGREGATION266').select('  GENERATED9').select('  AGGREGATION286').as('  AGGREGATION286').select('  AGGREGATION261', '  AGGREGATION266', '  AGGREGATION286').project('tag', 'persons').by(__.select('  AGGREGATION261')).by(__.select('  AGGREGATION286').as('  GENERATED10').select('  AGGREGATION266').choose(__.or(__.is(eq('  cypher.null')), __.select('  GENERATED10').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.local(__.union(__.unfold(), __.select('  GENERATED10').unfold()).fold()))).as('  GENERATED11').select('tag').as('tag').select('  GENERATED11').select('persons').as('persons').unfold().as('person').select('tag', 'person').project('tag', 'person').by(__.select('tag')).by(__.select('person')).dedup().as('  GENERATED12').select('tag').as('tag').select('  GENERATED12').select('person').as('person').select('tag', 'person').project('tag', 'person', 'score').by(__.select('tag')).by(__.select('person')).by(__.map(__.select('tag').as('  GENERATED18').where(__.select('  GENERATED18').where(eq('tag'))).inE('HAS_TAG').outV().as('message').has('creationDate', gt(date)).hasLabel('post', 'comment').outE('HAS_CREATOR').inV().as('  GENERATED21').where(__.select('  GENERATED21').where(eq('person'))).select('message').select('message').fold()).count(local).math('(_-1)/2').as('__GENERATED13').constant(100).as('__GENERATED14').map(__.select('tag').as('  GENERATED15').where(__.select('  GENERATED15').where(eq('tag'))).inE('HAS_INTEREST').as('interest').outV().as('  GENERATED17').where(__.select('  GENERATED17').where(eq('person'))).select('interest').select('interest').fold()).count(local).math('(_-1)/2').choose(__.or(__.is(eq('  cypher.null')), __.select('__GENERATED14').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.math('_ * __GENERATED14')).choose(__.or(__.is(eq('  cypher.null')), __.select('__GENERATED13').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.math('_ + __GENERATED13'))).as('  GENERATED22').select('tag').as('tag').select('  GENERATED22').select('person').as('person').select('  GENERATED22').select('score').as('score').choose(__.select('person').is(neq('  cypher.null')).bothE('KNOWS').dedup().by(__.path()).otherV().as('friend'), __.select('person').is(neq('  cypher.null')).bothE('KNOWS').dedup().by(__.path()).otherV().as('friend'), __.constant('  cypher.null').as('friend')).select('person', 'score', 'tag', 'friend').project('person', 'score', 'friendScore').by(__.select('person')).by(__.select('score')).by(__.map(__.select('tag').as('  GENERATED31').where(__.select('  GENERATED31').where(eq('tag'))).inE('HAS_TAG').outV().as('message').has('creationDate', gt(date)).hasLabel('post', 'comment').outE('HAS_CREATOR').inV().as('  GENERATED34').where(__.select('  GENERATED34').where(eq('friend'))).select('message').select('message').fold()).count(local).math('(_-1)/2').as('__GENERATED26').constant(100).as('__GENERATED27').map(__.select('tag').as('  GENERATED28').where(__.select('  GENERATED28').where(eq('tag'))).inE('HAS_INTEREST').as('interest').outV().as('  GENERATED30').where(__.select('  GENERATED30').where(eq('friend'))).select('interest').select('interest').fold()).count(local).math('(_-1)/2').choose(__.or(__.is(eq('  cypher.null')), __.select('__GENERATED27').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.math('_ * __GENERATED27')).choose(__.or(__.is(eq('  cypher.null')), __.select('__GENERATED26').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.math('_ + __GENERATED26'))).as('  GENERATED35').select('person').as('person').select('  GENERATED35').select('score').as('score').select('  GENERATED35').select('friendScore').as('friendScore').select('person', 'score', 'friendScore').group().by(__.project('person.id', 'score').by(__.select('person').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.select('score'))).by(__.fold().project('person.id', 'score', 'friendsScore').by(__.unfold().select('person').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.unfold().select('score')).by(__.unfold().select('friendScore').is(neq('  cypher.null')).fold().coalesce(__.sum(local), __.constant('  cypher.null')))).unfold().select(values).order().by(__.select('friendsScore').as('__GENERATED36').select('score').choose(__.or(__.is(eq('  cypher.null')), __.select('__GENERATED36').is(eq('  cypher.null'))), __.constant('  cypher.null'), __.math('_ + __GENERATED36')), desc).by(__.select('person.id'), asc).limit(100)