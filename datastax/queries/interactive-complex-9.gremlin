g.V().as('person').hasLabel('person').has('id', eq(personId)).emit(__.loops().is(gte(1))).repeat(__.bothE('knows').dedup().by(__.path()).as('  UNNAMED31').otherV()).times(2).simplePath().from('person').as('friend').where(__.select('person').where(neq('friend'))).optional(__.select(all, '  UNNAMED31').as('  UNNAMED31')).select('friend').project('friend').by(__.identity()).dedup().select('friend').as('friend').is(neq('  cypher.null')).inE('hasCreator').outV().as('message').has('creationDate', lt(maxDate)).select('friend', 'message').project('friend', 'message').by(__.select('friend')).by(__.select('message')).order().by(__.select('message').choose(neq('  cypher.null'), __.choose(__.values('creationDate'), __.values('creationDate'), __.constant('  cypher.null'))), desc).by(__.select('message').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null'))), asc).limit(20).as('  GENERATED5').select('friend').as('friend').select('  GENERATED5').select('message').as('message').select('message', 'friend').project('messageId', 'messageContent', 'messageCreationDate', 'personId', 'personFirstName', 'personLastName').by(__.select('message').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.coalesce(__.select('message').choose(neq('  cypher.null'), __.choose(__.values('content'), __.values('content'), __.constant('  cypher.null'))).is(neq('  cypher.null')), __.select('message').choose(neq('  cypher.null'), __.choose(__.values('imageFile'), __.values('imageFile'), __.constant('  cypher.null'))))).by(__.select('message').choose(neq('  cypher.null'), __.choose(__.values('creationDate'), __.values('creationDate'), __.constant('  cypher.null')))).by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('id'), __.values('id'), __.constant('  cypher.null')))).by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('firstName'), __.values('firstName'), __.constant('  cypher.null')))).by(__.select('friend').choose(neq('  cypher.null'), __.choose(__.values('lastName'), __.values('lastName'), __.constant('  cypher.null'))))